# adapted from https://github.com/imathis/octopress/blob/master/Rakefile   
# usage rake new_post['My New Post'] or rake new_post (defaults to "My New Post")
desc "Start a new post"
task :new do |t, args|
  params = defaults
  params.each do |k, v|
   puts "#{k} [#{v}]?"
   n = $stdin.gets.chomp
   if not n.nil? and not n.empty?
     params[k]=n
   end
 end
 generate params
end

def defaults()
  defaults=Hash.new
  defaults[:id]=Time.now.to_i
  defaults[:title]="New post title"
  defaults[:layout]="post"
  defaults[:type]=""
  defaults[:description]=""
  defaults[:headline]=""
  defaults[:modified]="#{Time.now.strftime('%Y-%m-%d')}"
  defaults[:category]="personal"
  defaults[:tags]="[]"
  defaults[:location]=""
  defaults[:imagefeature]=""
  defaults[:comments]="true"
  defaults
end

def generate(args)
  filename = "_posts/#{defaults[:modified]}-#{args[:title].downcase.gsub(/&/,'and').gsub(/[,'":\?!\(\)\[\]]/,'').gsub(/[\W\.]/, '-').gsub(/-+$/,'')}.md"
  puts "Creating new post: #{filename}"
  if File.file? filename
    fail "The file already exists"
  end
  open(filename, 'w') do |post|
    post.puts "---"
    args.each do |k, v|
      post.puts "#{k}: #{v}"
    end
    post.puts ""
    post.puts "---"
  end
end

